<html>
    <head>
        <link rel="icon" type="image/png" href="/favicon.png" />
        <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/monokai.min.css">
        <style>
            h1, h2 {
                text-align: center;
            }
            div.menuItem {
                display: inline-block;
                font-size: 150%;
            }
            span.hljs-lang-label {
                display: inline-block;
            }
            span.hljs-lang-label img {
                max-width: 24px;
                max-height: 24px;
                vertical-align: middle;
            }
        </style>
        <script src="highlight.pack.js"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="marked.js"></script>
        <script>
            (function($) {
                $.queryString = (function(a) {
                    if (a == "")
                        return {};

                    var b = {};

                    for (var i = 0; i < a.length; ++i) {
                        var p=a[i].split('=');

                        if (p.length != 2)
                            continue;

                        b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
                    }

                    return b;
                })(window.location.search.substr(1).split('&'))
            })(jQuery);

            String.prototype.endsWith = function(suffix) {
                return this.indexOf(suffix, this.length - suffix.length) !== -1;
            };

            $(function() {
                var articleDiv = $("#article");
                var articleId = $.queryString["articleId"];

                if (! articleId)
                    articleId = "default";

                var articleUrl = "./articles/" + articleId;

                if (! articleUrl.endsWith(".md"))
                    articleUrl += ".md";

                var request = {
                    type: "GET",
                    dataType: "text",
                    url: articleUrl,
                    success: function (articleMarkdown) {

                        if (articleMarkdown.indexOf('!!!disqus') > -1) {
                            var divTag = document.createElement('div');
                            divTag.id = 'disqus_thread';
                            var scriptTag = document.createElement('script');
                            scriptTag.src = '//rkoeningergithubio.disqus.com/embed.js';
                            var disqus = divTag.outerHTML + scriptTag.outerHTML;
                            articleMarkdown = articleMarkdown.replace('!!!disqus', disqus);
                        }

                        articleDiv.html(marked(articleMarkdown));
                        var titleMatches = articleMarkdown.match(/\x23\x20(.*)\x0D?\x0A/); // pull title from first h1 (#) element

                        if (titleMatches)
                            document.title = $(marked(titleMatches[1]))[0].textContent; // strip markdown formatting

                        hljs.initHighlighting();
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        articleDiv.html("failed to load article content<br />" + textStatus + "<br />" + errorThrown);
                    }
                };

                $.ajax(request);
            });
        </script>
    </head>
    <body>
        <div style="; margin: 0px auto; width: 650px;">
            <div class="menuItem"><a href="/index.html">Home</a></div>
            &nbsp;
            <div class="menuItem"><a href="/index.html?articleId=talesOfWin">Tales of Win</a></div>
            &nbsp;
            <div class="menuItem"><a href="/index.html?articleId=talesOfWoe">Tales of Woe</a></div>
            &nbsp;
            <div class="menuItem"><a href="/index.html?articleId=talesOfWonder">Tales of Wonder</a></div>
            <hr />
            <div id="article"></div>
        </div>
    </body>
</html>