<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <script src="markdown.min.js"></script>
        <script>
            (function($) {
                $.queryString = (function(a) {
                    if (a == "")
                        return {};

                    var b = {};

                    for (var i = 0; i < a.length; ++i) {
                        var p=a[i].split('=');

                        if (p.length != 2)
                            continue;

                        b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
                    }

                    return b;
                })(window.location.search.substr(1).split('&'))
            })(jQuery);

            String.prototype.endsWith = function(suffix) {
                return this.indexOf(suffix, this.length - suffix.length) !== -1;
            };

            $(function() {
                var articleDiv = $("#article");
                var articleId = $.queryString["articleId"];

                if (! articleId) {
                    articleDiv.html("article id needs to be specified in query string");
                    return;
                }

                var articleUrl = "./articles/" + articleId;

                if (! articleUrl.endsWith(".md"))
                    articleUrl += ".md";

                var request = {
                    type: "GET",
                    dataType: "text",
                    url: articleUrl,
                    success: function(articleMarkdown) {
                        articleDiv.html(markdown.toHTML(articleMarkdown));
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        articleDiv.html("failed to load article content<br />" + textStatus + "<br />" + errorThrown);
                    }
                };

                $.ajax(request);
            });
        </script>
    </head>
    <body>
        <div id="article">
        </div>
    </body>
</html>